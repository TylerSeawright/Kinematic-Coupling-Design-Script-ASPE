function [T_GC_BC,alpha,beta,gamma,xr,yr,zr,Pc]=kct_rest(PB,dB,TG11_G,TG12_G,TG21_G,TG22_G,TG31_G,TG32_G)
% This function calls the fsolve routine to solve the 24 nonlinear equations that provide the resting position ofthe ball body of a kinematic coupling in a groove body.Vectors PB1, PB2, PB3, and PB4 locate the centers of theballs in coordinate sytem located at the coupling centroid.TG11_G,TG12_G,TG21_G,TG22_G,TG31_G, and TG32_G are thetransformations from groove surfaces to groove coordinatesystem (ideally equal to ball coupling centroid). alpha,beta, and gamma, are rotations about x,y, and z,respectively. xr, yr, and zr are displacements, andPc1,Pc2,Pc3,Pc4,Pc5, and Pc6 are position vectors to thecontact points.
% Setup initial guesses for unknowns
vars=zeros(1,6);
vars(7:9)=PB(1:3,1); % Initial guess for the coordinates ofcontact point #1 are set to the center of ball #1
vars(10:12)=vars(7:9); % Initial guess for the coordinatesof contact point #2 are set to the center of ball #2
vars(13:15)=PB(1:3,2); % Initial guess for the coordinatesof contact point #3 are set to the center of ball #3
vars(16:18)=vars(13:15); % Initial guess for the coordinatesof contact point #4 are set to the center of ball #4
vars(19:21)=PB(1:3,3); % Initial guess for the coordinatesof contact point #5 are set to the center of ball #5
vars(22:24)=vars(19:21); % Initial guess for the coordinatesof contact point #6 are set to the center of ball #6
vars=vars';
% Setup params vector to pass variables to fsolve routine
params(1:3)=PB(1:3,1);
params(4:6)=PB(1:3,2);
params(7:9)=PB(1:3,3);
params(10:12)=PB(1:3,4);
params(13:15)=TG11_G(1:3,1);
params(16:18)=TG11_G(1:3,2);
params(19:21)=TG11_G(1:3,3);
params(22:24)=TG11_G(1:3,4);
params(25:27)=TG12_G(1:3,1);
params(28:30)=TG12_G(1:3,2);
params(31:33)=TG12_G(1:3,3);
params(34:36)=TG12_G(1:3,4);
params(37:39)=TG21_G(1:3,1);
params(40:42)=TG21_G(1:3,2);
params(43:45)=TG21_G(1:3,3);
params(46:48)=TG21_G(1:3,4);
params(49:51)=TG22_G(1:3,1);
params(52:54)=TG22_G(1:3,2);
params(55:57)=TG22_G(1:3,3);
params(58:60)=TG22_G(1:3,4);
params(61:63)=TG31_G(1:3,1);
params(64:66)=TG31_G(1:3,2);
params(67:69)=TG31_G(1:3,3);
params(70:72)=TG31_G(1:3,4);
params(73:75)=TG32_G(1:3,1);
params(76:78)=TG32_G(1:3,2);
params(79:81)=TG32_G(1:3,3);
params(82:84)=TG32_G(1:3,4);
params(85)=dB(1);
params(86)=dB(2);
params(87)=dB(3);
params(88)=dB(4);
params(89)=dB(5);
params(90)=dB(6);
params=params';
% Solve the nonlinear system of equations 
retvars=fsolve(@kct_seat,vars,optimset('Display','off'),params);
alpha=retvars(1);
beta=retvars(2);
gamma=retvars(3);
xr=retvars(4);
yr=retvars(5);
zr=retvars(6);
Pc1=[retvars(7:9);1];
Pc2=[retvars(10:12);1];
Pc3=[retvars(13:15);1];
Pc4=[retvars(16:18);1];
Pc5=[retvars(19:21);1];
Pc6=[retvars(22:24);1];
T_GC_BC(1:4,1)=[cos(alpha)*cos(beta);sin(alpha)*cos(beta);-sin(beta);0];
T_GC_BC(1:4,2)=[cos(alpha)*sin(beta)*sin(gamma)-sin(alpha)*cos(gamma);sin(alpha)*sin(beta)*sin(gamma)+cos(alpha)*cos(gamma);cos(beta)*sin(gamma);0];
T_GC_BC(1:4,3)=[cos(alpha)*sin(beta)*cos(gamma)+sin(alpha)*sin(gamma);sin(alpha)*sin(beta)*cos(gamma)-cos(alpha)*sin(gamma);cos(beta)*cos(gamma);0];
T_GC_BC(1:4,4)=[xr;yr;zr;1];
Pc = [Pc1,Pc2,Pc3,Pc4,Pc5,Pc6];